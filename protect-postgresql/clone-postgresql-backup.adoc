---
permalink: protect-postgresql/clone-postgresql-backup.html
sidebar: sidebar
keywords: SnapCenter Plug-in for PostgreSQL,run as
summary: 'You can use SnapCenter to clone a backup. You can clone from primary or secondary backup.'
---
= Clone a PostgreSQL backup
:icons: font
:imagesdir: ../media/

[.lead]
You can use SnapCenter to clone a backup. You can clone from primary or secondary backup.

.Before you begin

* You should have backed up the resources or resource group.
* You should ensure that the aggregates hosting the volumes should be in the assigned aggregates list of the storage virtual machine (SVM).
* For pre clone or post clone commands, you should check if the commands exist in the command list available on the plug-in host from the following paths:
** Default location on the Windows host: _C:\Program Files\NetApp\SnapCenter\Snapcenter Plug-in Creator\etc\allowed_commands.config_
** Default location on the Linux host: _/opt/NetApp/snapcenter/scc/etc/allowed_commands.config_

NOTE: If the commands do not exist in the command list, then the operation will fail.

.About this task

* For information about clone split operation limitations, see http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-cm-vsmg/home.html[ONTAP 9 Logical Storage Management Guide^].

* For ONTAP 9.12.1 and below version, the clones created from the SnapLock Vault Snapshots as part of restore will inherit the SnapLock Vault expiry time. Storage admin should manually cleanup the clones post the SnapLock expiry time.

[role="tabbed-block"]
====

.SnapCenter UI
--
.Steps

. In the left navigation pane, click *Resources*, and then select the appropriate plug-in from the list.
. In the Resources page, filter resources from the *View* drop-down list based on resource type.
+
The resources are displayed along with information such as type, host, associated resource groups and policies, and status.

. Select the resource or resource group.
+
You must select a resource if you select a resource group.
+
The resource or resource group topology page is displayed.

. From the Manage Copies view, select *Backups* either from the primary or secondary (mirrored or vaulted) storage systems.
. Select the data backup from the table, and then click image:../media/clone_icon.gif[clone icon].
. In the Location page, perform the following actions:
+
|===
| For this field...| Do this...

a|
Clone server
a|
Choose a host on which the clone should be created.
a|
Target Port
a|
Enter the target PostgreSQL target port to clone from the existing backups.
a|
NFS Export IP Address
a|
Enter IP addresses or the host names on which the cloned volumes will be exported.

This is applicable only to NFS storage type resource.
a|
Capacity Pool Max. Throughput (MiB/s)
a|
Enter the maximum throughput of a capacity pool.

This is applicable only for ANF storage type resource.
|===

. In the Scripts page, perform the following steps:
+
NOTE: The scripts are run on the plug-in host.

 .. Enter the commands for pre clone or post clone that should be run before or after the clone operation, respectively.
  *** Pre clone command: delete existing clusters with the same name
  *** Post clone command: verify a cluster or start a cluster.
 .. Enter the mount command to mount a file system to a host.
+
Mount command for a volume or qtree on a Linux machine:
+
Example for NFS: `mount VSERVER_DATA_IP:%VOLUME_NAME_Clone /mnt`
. In the Notification page, from the *Email preference* drop-down list, select the scenarios in which you want to send the emails.
+
You must also specify the sender and receiver email addresses, and the subject of the email.

. Review the summary, and then click *Finish*.
. Monitor the operation progress by clicking *Monitor* > *Jobs*.
--
.PowerShell cmdlets
--
.Steps 

. Initiate a connection session with the SnapCenter Server for a specified user by using the Open-SmConnection cmdlet.
+
----
PS C:\> Open-SmConnection  
----

. Retrieve the backups to perform the clone operation by using the Get-SmBackup cmdlet.
+
This example shows that two backups are available for cloning:
+
----
 C:\PS> Get-SmBackup

        BackupId                      BackupName                    BackupTime                    BackupType
        --------                      ----------                    ----------                    ----------
         1                     Payroll Dataset_vise-f6_08... 8/4/2015 11:02:32 AM          Full Backup
         2                     Payroll Dataset_vise-f6_08... 8/4/2015 11:23:17 AM
----

. Initiate a clone operation from an existing backup and specify the NFS export IP addresses on which the cloned volumes are exported.
+
This example shows that the backup to be cloned has an NFSExportIPs address of 10.32.212.14:
+
For PostgreSQL cluster:
+
----
PS C:\> New-SmClone -AppPluginCode PostgreSQL -BackupName " scpostgresql01_ openenglab_netapp_com_PostgreSQL_postgres_5432_06-26-2024_00_33_41_1570" -Resources @{"Host"=" 10.32.212.13";"Uid"="postgres_5432"} -port 2345 -CloneToHost 10.32.212.14
----
+
NOTE: If NFSExportIPs is not specified, the default is exported to the clone target host.

. Verify that the backups were cloned successfully by using the Get-SmCloneReport cmdlet to view the clone job details.
+
You can view details such as clone ID, start date and time, end date and time.
+
----
PS C:\> Get-SmCloneReport -JobId 186

    SmCloneId           : 1
    SmJobId             : 186
    StartDateTime       : 8/3/2015 2:43:02 PM
    EndDateTime         : 8/3/2015 2:44:08 PM
    Duration            : 00:01:06.6760000
    Status              : Completed
    ProtectionGroupName : Draper
    SmProtectionGroupId : 4
    PolicyName          : OnDemand_Clone
    SmPolicyId          : 4
    BackupPolicyName    : OnDemand_Full_Log
    SmBackupPolicyId    : 1
    CloneHostName       : SCSPR0054212005.mycompany.com
    CloneHostId         : 4
    CloneName           : Draper__clone__08-03-2015_14.43.53
    SourceResources     : {Don, Betty, Bobby, Sally}
    ClonedResources     : {Don_DRAPER, Betty_DRAPER, Bobby_DRAPER, Sally_DRAPER}
    SmJobError          :
----
--
====